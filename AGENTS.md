# Telegram Bot ¬´–ö—Ä–æ—Å—Å–≤–æ—Ä–¥—ã¬ª

–°–¥–µ–ª–∞—Ç—å Telegram-–±–æ—Ç–∞ —Å –≤–µ–±—Ö—É–∫–æ–º (**FastAPI**), —Ä–µ–∞–ª–∏–∑—É—é—â–µ–≥–æ –∏–≥—Ä—É —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ —Ä–µ—à–µ–Ω–∏–µ–º –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–æ–≤.

---

## üéØ –¶–µ–ª—å

–°–¥–µ–ª–∞—Ç—å Telegram-–±–æ—Ç–∞ —Å –≤–µ–±—Ö—É–∫–æ–º (**FastAPI**), –∫–æ—Ç–æ—Ä—ã–π:

- –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **—è–∑—ã–∫** –∏ **—Ç–µ–º—É** –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞;  
- —á–µ—Ä–µ–∑ **LangChain + OpenAI** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ (clues) –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ;  
- –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–ª–æ–≤–∞ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∞–ª—Ñ–∞–≤–∏—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –¥–µ—Ñ–∏—Å–æ–≤, –¥–ª–∏–Ω–∞ 3‚Äì15);  
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ (–¥–æ 15√ó15), —Ä–∞–∑–º–µ—â–∞—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–æ–≤–∞ –∏ –∑–∞–ø–æ–ª–Ω—è—è –æ—Å—Ç–∞–≤—à–µ–µ—Å—è;  
- —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–µ—Ç–∫—É –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞ –≤ **PNG** —á–µ—Ä–µ–∑ Pillow –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∏–≥—Ä–æ–∫—É;  
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (Across) –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (Down);  
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `/answer A1 –†–ò–ú`;  
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ç–∫—É, –Ω–∞—á–∏—Å–ª—è–µ—Ç –æ—á–∫–∏;  —Ö
- —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ **–¥–∏—Å–∫–µ Render** (–¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞);  
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã: `/new`, `/clues`, `/open A1`, `/answer A1`, `/hint A1`, `/state`, `/solve`;  
- —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ **–æ–¥–∏–Ω–æ—á–Ω–∞—è –∏–≥—Ä–∞** (–æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –±–æ—Ç).

---
## Multiplayer –≤–µ—Ä—Å–∏—è (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–æ–≤—É—é –∞–¥–º–∏–Ω-–≤–µ—Ä—Å–∏—é)
–°–º–æ—Ç—Ä–∏  - AGENTS_crossword_multiplayer.md

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### FastAPI
- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `/webhook` (POST);  
- —Å–ª—É–∂–µ–±–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã: `/healthz`, `/set_webhook`, `/reset_webhook`.  

### python-telegram-bot v20
- —Å–æ–∑–¥–∞—ë–º `Application` –≤ lifecycle FastAPI;
- –ø—Ä–∏–Ω–∏–º–∞–µ–º –∞–ø–¥–µ–π—Ç—ã —á–µ—Ä–µ–∑ `application.process_update(update)`;
- –∏—Å–ø–æ–ª—å–∑—É–µ–º job queue –¥–ª—è —Ç–∞–π–º–µ—Ä–æ–≤ –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫.
- –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞ –Ω–µ –∑–∞–±—ã–≤–∞–µ–º –ø—Ä–æ –º–∏–Ω—É—Ç–Ω—ã–µ –∏ –±–∏-–º–∏–Ω—É—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –∏ –ª—ë–≥–∫—É—é ¬´–∞–Ω–∏–º–∞—Ü–∏—é¬ª (typing/choose_sticker) ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Ç–µ–∫—É—â—É—é –º–µ—Ö–∞–Ω–∏–∫—É –≤ `app.py`.

### –ò–≥—Ä–∞
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –≤ **–ª–∏—á–Ω–æ–º —á–∞—Ç–µ** —Å –±–æ—Ç–æ–º;  
- –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–æ–≤–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Render Disk;  
- –±–æ—Ç —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PNG –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏.  

### –•—Ä–∞–Ω–∏–ª–∏—â–µ
- Render Persistent Disk (`/var/data/`), JSON-—Ñ–∞–π–ª—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è:  
  - `puzzles/{puzzle_id}.json` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞;  
  - `states/{chat_id}.json` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞.  
- JSON –≤–∫–ª—é—á–∞–µ—Ç: `grid`, `slots`, `filled_cells`, `solved_slots`, `score`, `created_at`.

### debug –ª–æ–≥–∏
-–ª–æ–≥–∏—Ä—É–π –∫–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏: LangChain-–≤—ã–∑–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–æ–≤, —à–∞–≥–∏ backtracking, —Ä–µ–Ω–¥–µ—Ä PNG, –ø—Ä–∏—ë–º –æ—Ç–≤–µ—Ç–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

### Puzzle
- `id`  
- `theme`  
- `language`  
- `size_rows`, `size_cols`  
- `grid[rows][cols]` (—è—á–µ–π–∫–∏: —á—ë—Ä–Ω–∞—è/–±—É–∫–≤–∞/–ø—É—Å—Ç–∞—è)  
- `slots[{slot_id, dir, number, start_row, start_col, length, clue, answer}]`  
- `created_at`

### GameState
- `chat_id`  
- `puzzle_id`  
- `filled_cells`  
- `solved_slots`  
- `score`  
- `hints_used`  
- `started_at`, `last_update`

---

## ‚ñ∂Ô∏è –ü–æ—Ç–æ–∫ –∏–≥—Ä—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç `/start` –∏–ª–∏ `/new`, —á—Ç–æ –≤–µ–¥—ë—Ç –≤ `start_new_game` –≤ `app.py`.
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–ª–∞–π–Ω-–º–µ–Ω—é —Å —Ä–µ–∂–∏–º–∞–º–∏ (–æ–¥–∏–Ω–æ—á–Ω—ã–π / –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä, –ø–ª—é—Å –∞–¥–º–∏–Ω-—Ç–µ—Å—Ç) –∏ –∂–¥—ë—Ç –≤—ã–±–æ—Ä –∫–Ω–æ–ø–∫–∏.
2. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –±–æ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —á–∞—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏–µ —è–∑—ã–∫–∞ –∏ —Ç–µ–º—ã.
   - –í –æ–¥–∏–Ω–æ—á–Ω–æ–º —á–∞—Ç–µ `_start_new_private_game` —Å—Ä–∞–∑—É –ø—Ä–æ—Å–∏—Ç —è–∑—ã–∫, –≤ –≥—Ä—É–ø–ø–∞—Ö `_start_new_group_game` –æ–±—ä—è–≤–ª—è–µ—Ç –ª–æ–±–±–∏ –∏ –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ —Ö–æ—Å—Ç–∞.
   - –ò–Ω–ª–∞–π–Ω-–º–µ–Ω—é –¥–ª—è —Ä–µ–∂–∏–º–∞ –Ω–µ –º–µ—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ `/new` –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ–Ω—é –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
3. –í—ã–±–æ—Ä —è–∑—ã–∫–∞ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫–æ–π –∏–ª–∏ —Ä—É—á–Ω—ã–º –≤–≤–æ–¥–æ–º.
   - `button_language_handler` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å –∫–Ω–æ–ø–æ–∫/–±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ–º–µ.
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —è–∑—ã–∫ –≤—Ä—É—á–Ω—É—é, –¥–∞—ë–º –ø–æ–Ω—è—Ç–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É: ¬´–í–≤–µ–¥–∏—Ç–µ —è–∑—ã–∫ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: `ru`¬ª –∏–ª–∏ ¬´`en`¬ª.
4. –¢–µ–º—É –ø—Ä–∏–Ω–∏–º–∞–µ–º —á–µ—Ä–µ–∑ `handle_theme` (–∏ `button_theme_handler` –¥–ª—è –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ UX).
   - –ü—Ä–æ—Å–∏–º —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—É –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ: ¬´–ù–∞–ø—Ä–∏–º–µ—Ä: `–î—Ä–µ–≤–Ω–∏–π –†–∏–º`¬ª, ¬´`Urban legends`¬ª, ¬´`–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è`¬ª.
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —è–∑—ã–∫ –≤—ã–±—Ä–∞–Ω, —á–∏—Å—Ç–∏—Ç –ø—Ä–æ—à–ª—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é.
5. –ß–µ—Ä–µ–∑ LangChain + OpenAI –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∏ –∫–ª—é–µ–≤ (–æ—Ç 10 –¥–æ 40).
6. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–æ–≤ (–∞–ª—Ñ–∞–≤–∏—Ç, –¥–ª–∏–Ω–∞, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å).
7. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ç–∫–∏ —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —ç—Ç–∞–ø–∞–º: `_build_word_components` —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å–ª–æ–≤–∞ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ –æ–±—â–∏–º –±—É–∫–≤–∞–º, `_select_connected_clue_set` –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Å–≤—è–∑–Ω—ã–π –ø–æ–¥–Ω–∞–±–æ—Ä –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, `request_replacement` –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É LLM –∑–∞–º–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–ª–æ–≤, –∞ `_generate_composite` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–º–µ–Ω—å—à–µ –ø–∞–∑–ª–æ–≤ –≤ –æ–¥–∏–Ω –∫–æ–º–ø–æ–∑–∏—Ç.
8. –†–µ–Ω–¥–µ—Ä PNG ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
9. –ë–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ Across / Down.
10. –ò–≥—Ä–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç `/answer A1 –†–ò–ú`.
    - –í–Ω—É—Ç—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–µ–∂–¥—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –∏ –æ—Ç–≤–µ—Ç–æ–º: –ø—Ä–æ–±–µ–ª—ã, –¥–≤–æ–µ—Ç–æ—á–∏–µ, –¥–µ—Ñ–∏—Å—ã/—Ç–∏—Ä–µ (`INLINE_ANSWER_PATTERN` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç `-`, `‚Äê`, `‚Äë`, `‚Äì`, `‚Äî`, `‚Äí`, `‚àí`).
    - –†–∞–∑—Ä–µ—à–µ–Ω—ã –∫–∞–∫ –±—É–∫–≤–µ–Ω–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`A1`, `B12-2`), —Ç–∞–∫ –∏ —á–∏—Å—Ç–æ —Ü–∏—Ñ—Ä–æ–≤—ã–µ (`14`).
11. –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞, —ë/–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤.
12. –ï—Å–ª–∏ –≤–µ—Ä–Ω–æ ‚Üí –±–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ç–∫—É, –Ω–∞—á–∏—Å–ª—è–µ—Ç –æ—á–∫–∏.
13. –ï—Å–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ ‚Üí ‚ùå –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.
14. –ü–æ–¥—Å–∫–∞–∑–∫–∞: `/hint A1` (–æ—Ç–∫—Ä—ã—Ç—å –±—É–∫–≤—É –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª—é).
15. –ò–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/state` (—Ç–µ–∫—É—â–∏–π PNG) –∏ `/clues`.
16. `/finish` –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–µ—Å—Å–∏—é –¥–æ—Å—Ä–æ—á–Ω–æ (–≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ ‚Äî –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∏–π, –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ ‚Äî —Ñ–∏–Ω–∞–ª –¥–ª—è –≤—Å–µ—Ö), `/solve` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Å–ª–æ–≤–∞, `/quit` ‚Äî –≤—ã—Ö–æ–¥ –∏–∑ –ª–æ–±–±–∏ –∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø–∞—Ä—Ç–∏–∏.

---

## üõ° –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

- –≤—Å–µ–≥–¥–∞ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `allowed_updates=[]` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–µ–±—Ö—É–∫–∞;  
- –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤–µ–±—Ö—É–∫–∞ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å;  
- –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π health-check –≤–µ–±—Ö—É–∫–∞;  
- –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ —É–¥–∞–ª—è—Ç—å –≤–µ–±—Ö—É–∫ (–ø—É—Å—Ç—å –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Telegram, —Ç–æ–≥–¥–∞ Render –ø–æ–¥–Ω–∏–º–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∞–ø–¥–µ–π—Ç–µ);  
- —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã –Ω–∞ –¥–∏—Å–∫–µ Render (`/var/data/`) –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ;  
- –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å `thread_id` (None ‚Üî 0);  
- –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤–∫–ª—é—á–∞—Ç—å DEBUG-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —à–∞–≥–æ–≤ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ç–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞, —Ä–µ–Ω–¥–µ—Ä PNG);  
- –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ LLM –∏ backtracking;  
- –¥–æ–±–∞–≤–ª—è—Ç—å fallback: –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ø–æ `chat_id`, –ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –¥–∏—Å–∫–µ;  
- —Ç—â–∞—Ç–µ–ª—å–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –∏–≥—Ä–æ–∫–æ–≤ (lowercase, trim, remove extra spaces).  

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ AGENTS.md
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ puzzles/
‚îÇ   ‚îî‚îÄ‚îÄ states/
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ llm_generator.py
    ‚îú‚îÄ‚îÄ crossword.py
    ‚îú‚îÄ‚îÄ render.py
    ‚îú‚îÄ‚îÄ validators.py
```

---

## üìú requirements.txt

```
python-telegram-bot>=20.6
fastapi>=0.110
uvicorn[standard]>=0.30
langchain>=0.2
openai>=1.40
pillow>=10.0
orjson>=3.9
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ª–æ–∫–∞–ª—å–Ω–æ

1. –°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.  
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:  
   ```
   pip install -r requirements.txt
   ```  
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:  
   ```
   uvicorn app:app --host 0.0.0.0 --port 8000
   ```  
4. –î–ª—è –≤–µ–±—Ö—É–∫–∞ –Ω—É–∂–µ–Ω —Ç—É–Ω–Ω–µ–ª—å (ngrok / cloudflared).  
   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `PUBLIC_URL` –∏ –≤—ã–∑–æ–≤–∏—Ç–µ:  
   ```
   GET /set_webhook
   ```  

---

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Render (Free)

1. –°–æ–∑–¥–∞–π—Ç–µ **Web Service** ‚Üí –ø–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.  
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:  
   - Build Command:  
     ```
     pip install -r requirements.txt
     ```  
   - Start Command:  
     ```
     uvicorn app:app --host 0.0.0.0 --port $PORT
     ```  
   - –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.  
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Render Disk –∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫ `/var/data/`.  
3. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ:  
   ```
   https://<service>.onrender.com/set_webhook
   ```  
4. –ò–≥—Ä–æ–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç `/new` –≤ –ª–∏—á–∫–µ —Å –±–æ—Ç–æ–º.  

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –æ—Ç @BotFather  
- `PUBLIC_URL` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π HTTPS-URL  
- `WEBHOOK_SECRET` ‚Äî –¥–ª–∏–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞  
- `OPENAI_API_KEY` ‚Äî –∫–ª—é—á –¥–ª—è LangChain + OpenAI  

### –°–ª—É–∂–µ–±–Ω—ã–µ
- `WEBHOOK_PATH` ‚Äî –ø—É—Ç—å –≤–µ–±—Ö—É–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/webhook`)
- `WEBHOOK_CHECK_INTERVAL` ‚Äî –ø–µ—Ä–∏–æ–¥ —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–µ–±—Ö—É–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–º–∏–Ω–∏–º—É–º 60, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `300`).
- `ADMIN_ID` ‚Äî —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –æ—Ç–∫—Ä—ã–≤–∞—é—â–∏–π –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∑–∞–¥–∞–Ω).
- `OPENAI_MODEL` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ OpenAI, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `utils/llm_generator.py` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `gpt-4o-mini`).
